<client:ToolPanelControl
    x:Class="IRExplorerUI.Profile.CallTreeNodePanel"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:client="clr-namespace:IRExplorerUI"
    xmlns:controls="clr-namespace:IRExplorerUI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:doc="clr-namespace:IRExplorerUI.Document"
    xmlns:local="clr-namespace:IRExplorerUI.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:profile="clr-namespace:IRExplorerUI.Profile"
    d:DesignHeight="450"
    d:DesignWidth="800"
    SnapsToDevicePixels="True"
    UseLayoutRounding="True"
    mc:Ignorable="d">
    <DockPanel
        HorizontalAlignment="Stretch"
        Background="{DynamicResource {x:Static SystemColors.ControlLightBrushKey}}"
        LastChildFill="True">
        <Grid HorizontalAlignment="Stretch" DockPanel.Dock="Top">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <StackPanel
                Grid.Column="0"
                Margin="4,2,4,2"
                HorizontalAlignment="Stretch">
                <StackPanel HorizontalAlignment="Stretch" Orientation="Horizontal">
                    <TextBlock
                        Width="70"
                        VerticalAlignment="Center"
                        Text="Time (total)" />

                    <ContentControl
                        MinWidth="150"
                        MaxWidth="200"
                        HorizontalAlignment="Stretch"
                        Content="{Binding Node}"
                        ContentTemplate="{StaticResource ProfilePercentageTemplate}" />
                </StackPanel>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Width="70" Text="Time (self)" />
                    <ContentControl
                        MinWidth="150"
                        MaxWidth="200"
                        HorizontalAlignment="Stretch"
                        Content="{Binding Node}"
                        ContentTemplate="{StaticResource ProfileExclusivePercentageTemplate}" />
                </StackPanel>
            </StackPanel>
            <Grid
                Grid.Column="1"
                Margin="0,0,4,0"
                Visibility="{Binding ShowDetails, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel HorizontalAlignment="Left" Orientation="Horizontal">
                    <TextBlock Margin="4,0,0,0" Text="{Binding CurrentInstanceIndex}" />
                    <TextBlock Text=" / " />
                    <TextBlock Text="{Binding FunctionInstancesCount}" />
                </StackPanel>
                <Button
                    x:Name="PreviousInstanceButton"
                    Margin="0,18,14,0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Background="{x:Null}"
                    BorderBrush="{x:Null}"
                    Click="PreviousInstanceButton_Click">
                    <Image
                        Width="14"
                        Height="14"
                        Source="{StaticResource DockLeftIcon}" />
                </Button>
                <Button
                    x:Name="NextInstanceButton"
                    Margin="0,18,-2,0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Background="{x:Null}"
                    BorderBrush="{x:Null}"
                    Click="NextInstanceButton_Click">
                    <Image
                        Width="14"
                        Height="14"
                        Source="{StaticResource DockRightIcon}" />
                </Button>
            </Grid>
        </Grid>

        <TabControl
            Padding="2"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            Background="{DynamicResource {x:Static SystemColors.ControlLightBrushKey}}"
            DockPanel.Dock="Bottom"
            Visibility="{Binding ShowDetails, Converter={StaticResource BoolToVisibilityConverter}}">
            <TabItem
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                HorizontalContentAlignment="Stretch"
                Header="Info">
                <ScrollViewer
                    HorizontalAlignment="Stretch"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto">
                    <StackPanel MaxWidth="{Binding ActualWidth, ElementName=ContentHost}" Margin="0,4,0,0">
                        <StackPanel Margin="4,2,0,0" Orientation="Horizontal">
                            <TextBlock
                                Width="70"
                                FontWeight="Medium"
                                Text="Instances" />
                            <TextBlock
                                Margin="4,0,0,0"
                                FontWeight="Medium"
                                Text="{Binding FunctionInstancesCount}" />
                        </StackPanel>

                        <StackPanel Margin="4,2,0,0" Orientation="Horizontal">
                            <TextBlock Width="70" Text="Total time" />
                            <ContentControl
                                Width="200"
                                Margin="4,0,0,0"
                                HorizontalAlignment="Left"
                                Content="{Binding InstancesNode}"
                                ContentTemplate="{StaticResource ProfileCombinedPercentageTemplate}" />
                        </StackPanel>

                        <StackPanel Margin="4,2,0,0" Orientation="Horizontal">
                            <TextBlock Width="70" Text="Median time" />
                            <ContentControl
                                Width="200"
                                Margin="4,0,0,0"
                                HorizontalAlignment="Left"
                                Content="{Binding MedianNode}"
                                ContentTemplate="{StaticResource ProfileCombinedPercentageTemplate}" />
                        </StackPanel>
                        <TextBlock
                            Margin="4,2,0,8"
                            Text="&gt; Histogram"
                            ToolTip="TODO" />
                        <Canvas
                            x:Name="InstanceHistogramHost"
                            Width="300"
                            Height="200"
                            HorizontalAlignment="Left"
                            Background="Gray" />

                        <TextBlock
                            Margin="4,2,0,0"
                            HorizontalAlignment="Left"
                            FontWeight="Medium"
                            Text="Module" />
                        <Canvas
                            x:Name="ModuleCanvas"
                            Height="{Binding ElementName=ModuleTextBlock, Path=ActualHeight}"
                            Margin="0,0,42,0"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch">
                            <TextBox
                                x:Name="ModuleTextBlock"
                                Width="{Binding ElementName=ModuleCanvas, Path=ActualWidth}"
                                Background="{x:Null}"
                                BorderBrush="{x:Null}"
                                IsReadOnly="True"
                                MaxLines="2"
                                ScrollViewer.CanContentScroll="True"
                                ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                ScrollViewer.VerticalScrollBarVisibility="Auto"
                                Text="{Binding Path=Node.ModuleName}"
                                TextWrapping="Wrap" />
                        </Canvas>

                        <StackPanel Orientation="Horizontal">
                            <TextBlock
                                Margin="4,2,16,0"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                FontWeight="Medium"
                                Text="Function name" />
                            <ContentPresenter
                                VerticalAlignment="Center"
                                Content="{Binding}"
                                ContentTemplate="{StaticResource ExecutionContextTemplate}" />
                        </StackPanel>
                        <Canvas
                            x:Name="FunctionCanvas"
                            Height="{Binding ElementName=FunctionTextBlock, Path=ActualHeight}"
                            Margin="0,0,42,0"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch">
                            <TextBox
                                x:Name="FunctionTextBlock"
                                Width="{Binding ElementName=FunctionCanvas, Path=ActualWidth}"
                                HorizontalAlignment="Stretch"
                                Background="{x:Null}"
                                BorderBrush="{x:Null}"
                                IsReadOnly="True"
                                ScrollViewer.CanContentScroll="True"
                                ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                ScrollViewer.VerticalScrollBarVisibility="Auto"
                                Text="{Binding Path=Node.FullFunctionName}"
                                TextWrapping="Wrap" />
                        </Canvas>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            <TabItem
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Header="Backtrace"
                ToolTip="Reverse call stack for selected function">
                <profile:ProfileListView
                    x:Name="BacktraceList"
                    NameColumnTitle="Function"
                    ShowCombinedTimeNameRow="True"
                    ShowContextColumn="True"
                    ShowModuleColumn="True" />
            </TabItem>

            <TabItem
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Header="Functions"
                ToolTip="Self time for functions under this instance">
                <profile:ProfileListView
                    x:Name="FunctionList"
                    NameColumnTitle="Function"
                    ShowContextColumn="True"
                    ShowExclusiveTimeNameRow="True"
                    ShowModuleColumn="True" />
            </TabItem>
            <TabItem
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Header="Modules"
                ToolTip="Self time for modules under this instance">
                <profile:ProfileListView
                    x:Name="ModuleList"
                    ExclusiveTimeColumnTitle="Time"
                    NameColumnTitle="Module"
                    ShowTimeNameRow="True" />
            </TabItem>

            <TabItem
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Header="Instances"
                ToolTip="All unique instances of this function">
                <profile:ProfileListView
                    x:Name="InstancesList"
                    NameColumnTitle="Function"
                    ShowCombinedTimeNameRow="True"
                    ShowContextColumn="True" />
            </TabItem>
        </TabControl>
    </DockPanel>
</client:ToolPanelControl>